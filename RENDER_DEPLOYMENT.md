 # Render Deployment Guide

This guide will help you deploy your AI Survey MVP to Render using the included `render.yaml` blueprint.

## Prerequisites

1. A [Render account](https://render.com)
2. Your code pushed to a Git repository (GitHub, GitLab, etc.)
3. Environment variables configured (see Environment Variables section below)

## Quick Deploy with Blueprint

1. **Fork/Clone this repository** to your GitHub account
2. **Connect to Render**:
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New" â†’ "Blueprint"
   - Connect your GitHub repository
   - Select this repository
3. **Review the Blueprint**: Render will show you the services that will be created:
   - `ai-survey-db` - PostgreSQL database
   - `ai-survey-api` - Backend Express.js API (with `rootDir: api`)
   - `ai-survey-web` - Frontend React static site (with `rootDir: web`)
4. **Configure Environment Variables**: Add any optional environment variables (see below)
5. **Deploy**: Click "Apply" to create all services

### Blueprint Features

The `render.yaml` follows Render's best practices:

- **`rootDir`**: Each service only builds when its specific folder changes
- **`buildFilter`**: Optimized builds that only trigger for relevant file changes
- **Static Site**: Frontend deployed as a static site with SPA routing
- **Auto-generated Secrets**: JWT secrets are automatically generated securely
- **Database Integration**: API automatically connects to managed PostgreSQL

## Environment Variables

After deployment, you'll need to configure these environment variables in the Render dashboard:

### Required for Basic Functionality

#### API Service (`ai-survey-api`)
- `JWT_SECRET` - Random string for JWT signing (auto-generated by Render)
- `NODE_ENV` - Set to `production`

#### Web Service (`ai-survey-web`)
- `VITE_API_URL` - Automatically set to your API service URL

### Optional Features

#### OpenAI Integration
- `OPENAI_API_KEY` - Your OpenAI API key

#### Email (SendGrid)
- `SENDGRID_API_KEY` - Your SendGrid API key
- `EMAIL_FROM` - From email address
- `EMAIL_REPLY_TO` - Reply-to email address

#### Auth0 (if using Auth0 instead of local auth)
- `AUTH0_SECRET` - Random string (auto-generated by Render)
- `AUTH0_BASE_URL` - Your web app URL (auto-set)
- `AUTH0_ISSUER_BASE_URL` - Your Auth0 domain (e.g., `https://your-domain.auth0.com`)
- `AUTH0_CLIENT_ID` - Your Auth0 application client ID
- `AUTH0_CLIENT_SECRET` - Your Auth0 application client secret

## Manual Deployment (Alternative)

If you prefer to set up services manually:

### 1. Create Database
- Service: PostgreSQL
- Plan: Starter (or higher based on needs)
- Database Name: `ai_survey_mvp`

### 2. Create API Service
- Type: Web Service
- Runtime: Node.js
- Build Command: `cd api && npm install`
- Start Command: `cd api && npm start`
- Health Check Path: `/health`
- Plan: Starter (or higher)

### 3. Create Web Service
- Type: Static Site
- Build Command: `cd web && npm install && npm run build`
- Publish Directory: `web/dist`

## Post-Deployment Setup

1. **Database Initialization**: The API will automatically initialize the database schema on first startup
2. **Create Admin User**: Use the provided scripts in `/api/scripts/` to create your first admin user
3. **Configure Organization**: Set up your organization through the admin interface

## Health Checks

The API includes a health check endpoint at `/health` that:
- Tests database connectivity
- Returns service status
- Provides timestamp information

## CORS Configuration

The API is configured to accept requests from your frontend domain automatically. The `CLIENT_ORIGIN` environment variable is set automatically to your web service URL.

## Troubleshooting

### Common Issues

1. **Database Connection Errors**
   - Ensure `DATABASE_URL` is properly set
   - Check that the database service is running

2. **CORS Errors**
   - Verify `CLIENT_ORIGIN` matches your frontend URL
   - Check that credentials are properly configured

3. **Build Failures**
   - Check Node.js version compatibility (requires Node 20+)
   - Verify all dependencies are listed in package.json

### Logs

Access logs through the Render dashboard:
- Go to your service
- Click "Logs" tab
- Monitor real-time logs for debugging

## Scaling

- **Database**: Upgrade to higher plans for more storage/performance
- **API**: Scale vertically (upgrade plan) or horizontally (multiple instances)
- **Web**: Static sites auto-scale on Render's CDN

## Security

- All services use HTTPS by default
- Database connections use SSL
- Environment variables are encrypted at rest
- Regular security updates through Render

## Support

For deployment issues:
1. Check Render's [documentation](https://render.com/docs)
2. Review service logs in the dashboard
3. Check the troubleshooting section above
